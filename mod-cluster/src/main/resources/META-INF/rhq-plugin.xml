<?xml version="1.0" encoding="UTF-8" ?>

<plugin name="mod_cluster"
        displayName="mod_cluster"
        version="1.0"
        package="org.rhq.plugins.modcluster"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="urn:xmlns:rhq-plugin"
        xmlns:c="urn:xmlns:rhq-configuration">

   <depends plugin="JMX" />

   <service name="mod_cluster"
           discovery="org.rhq.plugins.jmx.MBeanResourceDiscoveryComponent"
           class="ModclusterServerComponent"
           supportsManualAdd="true"
           description="mod_cluster plugin"
           singleton="true">
           
      <runs-inside>         
         <parent-resource-type name="JBossAS Server" plugin="JBossAS"/>
         <parent-resource-type name="JBossAS5 Server" plugin="JBossAS5"/>
      </runs-inside>
      
      <plugin-configuration>        
         <c:simple-property name="objectName" readOnly="true" default="Catalina:type=ModClusterListener,*"/>
         <c:simple-property name="nameTemplate" default="mod_cluster"/>         
      </plugin-configuration>
      
      <operation name="reset" displayName="Reset the node" description="Move the node out of an error state" />
      <operation name="refresh" displayName="Refresh configuration" description="Refresh configuration" />
      <operation name="enable" displayName="Enable all webapps" description="Enable all webapps for all engines">
      	<results>
      		<c:simple-property name="result" type="boolean" description="The result of the operation" />
      	</results>
      </operation>
      <operation name="disable" displayName="Disable all webpapps" description="Disable all webapps for all engines">
      	<results>
      		<c:simple-property name="result" type="boolean" description="The result of the operation" />
      	</results>
      </operation>
      
      <metric property="proxyConfiguration" displayName="Proxy Configuration" displayType="summary" dataType="trait" />
      <metric property="modelerType" displayName="Type of the modeled resource" displayType="summary" dataType="trait" />
      <metric property="className" displayName="Fully qualified class name of the managed object" displayType="summary" dataType="trait" />
      
      <resource-configuration>
      	<c:simple-property name="workerTimeout" type="int" description="Timeout to wait for an available worker (default is no wait)"
      	<c:simple-property name="stickySession" type="boolean" description="Enables sticky session for the cluster."/>
      	<c:simple-property name="stickySessionRemove" type="boolean" description="Remove session when the request cannot be routed to the right node."/>
      	<c:simple-property name="advertise" type="boolean" description="Enable autodiscovery of httpd servers."/>
      	<c:simple-property name="smax" type="int" description="Maximum time on seconds for idle connections above smax."/>
      	<c:simple-property name="maxAttempts" type="int" description="Maximum number of attempts to send the request to the backend server."/>
      	<c:simple-property name="advertiseSecurityKey" type="int" description="Security key for discovery."/>
      	<c:simple-property name="stickySessionForce" type="boolean" description="Return an error when the request cannot be routed to the right node."/>
      	<c:simple-property name="balancer" type="string" description="Name of the balancer."/>
      	<c:simple-property name="flushPackets" type="boolean" descritpion="Allows controlling flusing of packets."/>
      	<c:simple-property name="socketTimeout" type="int" description="Connection timeout for communication with the proxy." />
      	<c:simple-property name="containerName" type="string" description="Object name of the container."/>
      	<c:simple-property name="domain" type="string" description="Domain parameter, which allows tying a jvmRoute to a particular domain."/>
      	<c:simple-property name="advertisePort" type="int" description="Multicast port for discovery" />
      	<c:simple-property name="advertiseGroupAddress" type="string" description="Multicast address for discovery."/>
      	<c:simple-property name="flushWait" type="int" description="Time in ms to wait before flushing packets."/>
      	<c:simple-property name="ping" type="int" description="Time in s to wait for a pong answer to a ping"/>
      </resource-configuration>
      
       <service name="mod_cluster Webapp Context"
         discovery="ContextDiscoveryComponent"
         class="ContextComponent"
         description="A mod_cluster context">

      	<operation name="enableContext" displayName="Enable webapp" description="Enable this webapp">
      		<results>
      			<c:simple-property name="result" type="boolean" description="The result of the operation" />
      		</results>
      	</operation>
      	<operation name="disableContext" displayName="Disable webapp" description="Disable this webapp">
      		<results>
	      		<c:simple-property name="result" type="boolean" description="The result of the operation" />
      		</results>
      	</operation>
      	<operation name="stopContext" displayName="Stop webapp" description="Gracefully stops this webapp.">
      		<results>
	      		<c:simple-property name="result" type="boolean" description="The result of the operation" />
      		</results>
      	</operation>

      </service>
      
      
   </service>
</plugin>
