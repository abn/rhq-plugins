<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE plugin [

        <!ENTITY logSources '
    <c:group name="event" displayName="Events">
        <c:list-property name="logEventSources">
            <c:map-property name="logEventSource">
                <c:simple-property name="logFilePath" type="file" summary="true"
                                   description="The absolute path to the source log file."/>
                <c:simple-property name="enabled" type="boolean" summary="true"
                                   description="A flag indicating whether of not this log Event source is currently
                                                enabled (i.e. whether the associated log file should be tailed for
                                                new entries)."/>
                <c:simple-property name="dateFormat" required="false"
                                   description="The date format to use when parsing the dates in log entries. The
                                                format must be in the syntax defined by the Java SimpleDateFormat
                                                class. If not specified, the three date formats that are predefined
                                                by Log4J (ISO8601, DATE, and ABSOLUTE) will be tried."/>
                <c:simple-property name="includesPattern" required="false"
                                   description="A regular expression against which a log entrys detail is matched
                                                to determine if an Event should be fired for that entry. If not
                                                specified, no filtering of log entries will be done based on their
                                                detail."/>
                <c:simple-property name="minimumSeverity" required="false" default="error"
                                   description="The minimum severity of Events that should be collected for this
                                                source. If not specified, there is no minimum severity (i.e. all
                                                events will be collected).">
                    <c:property-options>
                       <c:option name="debug" value="debug"/>
                       <c:option name="info"  value="info"/>
                       <c:option name="warn"  value="warn"/>
                       <c:option name="error" value="error"/>
                       <c:option name="fatal" value="fatal"/>
                    </c:property-options>
                </c:simple-property>
            </c:map-property>
        </c:list-property>
    </c:group>
'>

        ]>

<plugin name="jboss-as-7"
        displayName="JBoss-AS-7-Plugin"
        description="Management of JBossAS 7"
        package="org.rhq.modules.plugins.jbossas7"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="urn:xmlns:rhq-plugin"
        xmlns:c="urn:xmlns:rhq-configuration"
        version="4.0.0-SNAPSHOT"
        >

    <depends plugin="JMX" useClasses="true"/>


    <!-- TODO I think we should introduce an abstract AS7 plugin that contains some base functionality and then
      ~~      additional 'Personalities' for the kinds of servers (PM, SM, Standalone AS, Managed AS)
      -->

    <server name="ProcessController"
            discovery="BaseProcessDiscovery"
            class="BaseComponent"
            description="Reaper process for other AS7 servicees"
            >

        <plugin-configuration>
            <c:simple-property name="hostname" default="localhost" required="true"/>
            <c:simple-property name="port" default="9990" type="integer" required="true"/>

            &logSources;
        </plugin-configuration>

        <process-scan name="ProcessManager" query="process|basename|match=^java.*,arg|org.jboss.as.process-controller|match=.*"/>


        <operation name="dummyOperation">
            <!-- TODO supply parameters and return values -->
        </operation>


    </server>
    <server name="HostController"
            discovery="BaseProcessDiscovery"
            class="BaseComponent"
            description="Domain controller delegate for this host"
            >

        <plugin-configuration>
            <c:simple-property name="hostname" default="localhost" required="true"/>
            <c:simple-property name="port" default="9990" type="integer" required="true"/>

            &logSources;
        </plugin-configuration>

        <process-scan name="ProcessManager" query="process|basename|match=^java.*,arg|org.jboss.as.host-controller|match=.*"/>


        <operation name="dummyOperation">
            <!-- TODO supply parameters and return values -->
        </operation>


    </server>

    <server name="Domain"
            discovery="DomainDiscovery"
            class="BaseComponent"
            description="An AS7 management profile">


        <server name="Profile"
                description="One profile in a domain"
                discovery="SubsystemDiscovery"
                class="BaseComponent">

            <plugin-configuration>
                <c:simple-property name="path" default="/profile/*" readOnly="true"/>
            </plugin-configuration>
        </server>
        <server name="ServerGroup"
                description="Server groups on this domain"
                discovery="SubsystemDiscovery"
                class="BaseComponent">
            <plugin-configuration>
                <c:simple-property name="path" default="/server-group/*" readOnly="true"/>
            </plugin-configuration>

            <resource-configuration>
                <c:simple-property name="profile" />
                <c:simple-property name="socket-binding-group"/>
                <c:simple-property name="jvm"/>
                <c:simple-property name="deployment" required="false"/> <!-- TODO change structure. Or put below as resource? -->
            </resource-configuration>
        </server>
        <server name="Host"
                description="Host involved in this domain"
                discovery="SubsystemDiscovery"
                class="BaseComponent"
                >
            <plugin-configuration>
                <c:simple-property name="path" default="/host/*" readOnly="true"/>
            </plugin-configuration>

            <resource-configuration>
                <c:list-property name="server-config" />
            </resource-configuration>

        </server>

    </server>

    <server name="JBossAS7-Standalone"
            discovery="BaseProcessDiscovery"
            class="BaseComponent"
            >

        <plugin-configuration>
            <c:simple-property name="hostname" default="localhost" required="true"/>
            <c:simple-property name="port" default="9990" type="integer" required="true"/>
            <c:list-property name="system-properties">
                <c:map-property name="system-property">
                    <c:simple-property name="key" readOnly="true"/>
                    <c:simple-property name="value" readOnly="true"/>
                </c:map-property>
            </c:list-property>
            &logSources;
        </plugin-configuration>

        <process-scan name="StandaloneAS" query="process|basename|match=^java.*,arg|org.jboss.as.standalone|match=.*"/>


        <resource-configuration>
            <c:list-property name="schema-locations" displayName="Schema locations">
                <c:map-property name="location">
                    <c:simple-property name="urn" readOnly="true"/>
                    <c:simple-property name="location" readOnly="true"/>
                </c:map-property>
            </c:list-property>
            <c:list-property name="extension" displayName="Installed extensions">
                <c:simple-property name="name" readOnly="true"/>
            </c:list-property>
        </resource-configuration>



    </server>

    <server name="JBossAS-Managed"
            discovery="BaseProcessDiscovery"
            class="BaseComponent"
            >
        <plugin-configuration>
            <c:simple-property name="hostname" default="localhost" required="true"/>
            <c:simple-property name="port" default="9990" type="integer" required="true"/>

            &logSources;
        </plugin-configuration>

        <process-scan name="ManagedAS" query="process|basename|match=^java.*,arg|org.jboss.as.server|match=.*"/>

    </server>


<!--
    <server name="JBoss AS JVM"
            description="JVM of the standalone JBossAS"
            sourcePlugin="JMX"
            sourceType="JMX Server"
            discovery="org.rhq.plugins.jmx.LocalJMXServerDiscoveryComponent"
            class="org.rhq.plugins.jmx.JMXServerComponent"
            singleton="true"
    >
        <runs-inside>
            <parent-resource-type name="JBossAS-Managed"  plugin="jboss-as-7"/>
            <parent-resource-type name="JBossAS7-Standalone"  plugin="jboss-as-7"/>
            <parent-resource-type name="ProcessController"  plugin="jboss-as-7"/>
        </runs-inside>
    </server>
-->

    <server name="Messaging"
            discovery="SubsystemDiscovery"
            class="BaseComponent"
            singleton="true"
            >
        <runs-inside>
            <parent-resource-type name="Profile"  plugin="jboss-as-7"/>
            <parent-resource-type name="JBossAS7-Standalone"  plugin="jboss-as-7"/>
        </runs-inside>

        <plugin-configuration>
            <c:simple-property name="path" readOnly="true" default="/subsystem/messaging"/>
        </plugin-configuration>

        <resource-configuration>
            <c:simple-property name="journal-min-files" />
            <c:simple-property name="journal-type" />
        </resource-configuration>


        <service name="Acceptor"
                 discovery="SubsystemDiscovery"
                 class="BaseComponent"
                >
            <plugin-configuration>
                <c:simple-property name="path" readOnly="true" default="/acceptor"/>
            </plugin-configuration>


        </service>

    </server>

    <server name="JBossWeb"
            discovery="SubsystemDiscovery"
            class="BaseComponent"
            singleton="true"
            >

        <runs-inside>
            <parent-resource-type name="Profile"  plugin="jboss-as-7"/>
            <parent-resource-type name="JBossAS7-Standalone"  plugin="jboss-as-7"/>
        </runs-inside>

        <plugin-configuration>
            <c:simple-property name="path" readOnly="true" default="/subsystem/web"/>
        </plugin-configuration>

        <service name="Connector"
                 discovery="SubsystemDiscovery"
                 class="BaseComponent"
                >
            <plugin-configuration>
                <c:simple-property name="path" readOnly="true" default="/connector/*"/>
            </plugin-configuration>


            <metric property="bytesSent" measurementType="trendsup"/>
            <metric property="bytesReceived" measurementType="trendsup"/>
            <metric property="processingTime" measurementType="trendsup"/>
            <metric property="errorCount" measurementType="trendsup"/>
            <metric property="maxTime" />
            <metric property="requestCount" measurementType="trendsup"/>

            <resource-configuration>
                <c:simple-property name="protocol" required="false" description="The web connector protocol."/>
                <c:simple-property name="socket-binding" required="false" description="The web connector socket-binding reference, this connector should be bound to."/>
                <c:simple-property name="scheme" required="false" description="The web connector scheme"/>
            </resource-configuration>

        </service>

        <service name="VHost"
                 discovery="SubsystemDiscovery"
                 class="BaseComponent">
            <plugin-configuration>
                <c:simple-property name="path" readOnly="true" default="/virtual-server/*"/>
            </plugin-configuration>

            <resource-configuration>
                <c:simple-property name="access-log"/>
                <c:list-property name="alias" description="The virtual server aliases"/>
                <c:simple-property name="rewrite"/>
            </resource-configuration>

        </service>


    </server>

    <service name="NetworkInterface"
             discovery="InterfaceDiscovery"
             class="BaseComponent"
             description="A named network interface, along with required criteria for determining the IP address to associate with that interface">

        <runs-inside>
            <parent-resource-type name="Domain"  plugin="jboss-as-7"/>
            <parent-resource-type name="Host"  plugin="jboss-as-7"/>
            <parent-resource-type name="JBossAS7-Standalone"  plugin="jboss-as-7"/>
        </runs-inside>

        <plugin-configuration>
            <c:simple-property name="path" readOnly="true" default="/"/>
        </plugin-configuration>
    </service>

    <service name="SocketBindingGroup"
             discovery="SocketBindingGroupDiscovery"
             class="BaseComponent"
            >
        <runs-inside>
            <parent-resource-type name="Domain"  plugin="jboss-as-7"/>
            <parent-resource-type name="JBossAS7-Standalone"  plugin="jboss-as-7"/>
        </runs-inside>


        <plugin-configuration>
            <c:simple-property name="path" readOnly="true" default="/socket-binding-group/"/>
        </plugin-configuration>

        <resource-configuration>
            <c:simple-property name="default-interface" readOnly="true" displayName="Default Interface" description="Default Interface for these bindings. See NetworkInterfaces for its definition" required="false"/>
            <!-- note: at domain level there is no port-offset -->
            <c:simple-property name="port-offset" readOnly="true" displayName="Port Offset" description="Offset from standard ports for this group" required="false"/>
            <c:list-property name="include">
                <c:simple-property name="binding" displayName="Included bindings" description="Other bindings that are included in this one"/>
            </c:list-property>
            <c:list-property name="socket-binding">
                <c:map-property name="binding">
                    <c:simple-property name="name" description="The name of the socket. Services which need to access the socket configuration information will find it using this name."/>
                    <c:simple-property name="interface" description="Name of the interface to which the socket should be bound, or, for multicast sockets, the interface on which it should listen. This should be one of the declared interfaces." required="false"/>
                    <c:simple-property name="port" description="Number of the port to which the socket should be bound." type="integer"/>
                    <c:simple-property name="fixed-port" description="Whether the port value should remain fixed even if numeric offsets are applied to the other sockets in the socket group." type="boolean"/>
                    <c:simple-property name="multicast-address" description="Multicast address on which the socket should receive multicast traffic. If unspecified, the socket will not be configured to receive multicast." />
                    <c:simple-property name="multicast-port" description="Port on which the socket should receive multicast traffic. Must be configured if 'multicast-address' is configured." type="integer"/>
                </c:map-property>
            </c:list-property>
        </resource-configuration>

    </service>

</plugin>
